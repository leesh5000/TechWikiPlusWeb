name: Pipeline Summary

on:
  workflow_run:
    workflows: ["CI/CD Pipeline"]
    types:
      - completed

jobs:
  summary:
    name: Generate Pipeline Summary
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event.workflow_run.conclusion == 'failure' }}
    
    steps:
      - name: Pipeline Summary
        env:
          CONCLUSION: ${{ github.event.workflow_run.conclusion }}
          WORKFLOW_URL: ${{ github.event.workflow_run.html_url }}
        run: |
          echo "# ðŸ“Š CI/CD íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ìš”ì•½" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "$CONCLUSION" == "success" ]; then
            echo "## âœ… íŒŒì´í”„ë¼ì¸ ì„±ê³µ" >> $GITHUB_STEP_SUMMARY
          else
            echo "## âŒ íŒŒì´í”„ë¼ì¸ ì‹¤íŒ¨" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“‹ ì‹¤í–‰ ì •ë³´" >> $GITHUB_STEP_SUMMARY
          echo "| í•­ëª© | ê°’ |" >> $GITHUB_STEP_SUMMARY
          echo "| --- | --- |" >> $GITHUB_STEP_SUMMARY
          echo "| ì›Œí¬í”Œë¡œìš° | CI/CD Pipeline |" >> $GITHUB_STEP_SUMMARY
          echo "| ì‹¤í–‰ ID | #${{ github.event.workflow_run.run_number }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ë¸Œëžœì¹˜ | ${{ github.event.workflow_run.head_branch }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ì»¤ë°‹ | ${{ github.event.workflow_run.head_sha }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ì‹¤í–‰ ì‹œê°„ | ${{ github.event.workflow_run.created_at }} |" >> $GITHUB_STEP_SUMMARY
          echo "| [ìƒì„¸ ë³´ê¸°]($WORKFLOW_URL) | ðŸ”— |" >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”„ ë‹¤ìŒ ë‹¨ê³„" >> $GITHUB_STEP_SUMMARY
          if [ "$CONCLUSION" == "success" ]; then
            echo "- ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ í™•ì¸" >> $GITHUB_STEP_SUMMARY
            echo "- ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ í™•ì¸" >> $GITHUB_STEP_SUMMARY
            echo "- ì‚¬ìš©ìž í”¼ë“œë°± ìˆ˜ì§‘" >> $GITHUB_STEP_SUMMARY
          else
            echo "- ì‹¤íŒ¨í•œ ë‹¨ê³„ ë¡œê·¸ í™•ì¸" >> $GITHUB_STEP_SUMMARY
            echo "- ì˜¤ë¥˜ ìˆ˜ì • í›„ ìž¬ì‹¤í–‰" >> $GITHUB_STEP_SUMMARY
            echo "- í•„ìš”ì‹œ ë¡¤ë°± ìˆ˜í–‰" >> $GITHUB_STEP_SUMMARY
          fi